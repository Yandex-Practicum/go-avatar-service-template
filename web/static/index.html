<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Avatar Upload</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          animation: {
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
          }
        }
      }
    }
  </script>
</head>

<body class="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900">
  <div class="container mx-auto px-4 py-8 max-w-2xl">
    <div class="bg-white/10 backdrop-blur-lg rounded-2xl shadow-2xl border border-white/20 overflow-hidden">
      <header class="bg-gradient-to-r from-purple-600 to-blue-600 p-6">
        <h1 class="text-3xl font-bold text-white text-center">Avatar Upload Service</h1>
        <p class="text-white/80 text-center mt-2">Upload your avatar image</p>
      </header>

      <main class="p-6 space-y-6">
        <form id="uploadForm" class="space-y-4">
          <div>
            <label for="userId" class="block text-sm font-medium text-white mb-2">
              User ID <span class="text-red-400">*</span>
            </label>
            <input type="text" id="userId" name="userId" required placeholder="Enter your user ID"
              class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
          </div>

          <div>
            <label for="image" class="block text-sm font-medium text-white mb-2">
              Choose Image <span class="text-red-400">*</span>
            </label>
            <div class="relative">
              <input type="file" id="image" name="image" accept="image/*" required
                class="w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-purple-600 file:text-white hover:file:bg-purple-700 cursor-pointer focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all">
            </div>
            <div id="imagePreview" class="mt-4 hidden">
              <img id="previewImg" src="" alt="Preview" class="w-32 h-32 object-cover rounded-lg shadow-lg mx-auto">
            </div>
          </div>

          <button type="submit" id="submitBtn"
            class="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-lg hover:from-purple-700 hover:to-blue-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 focus:ring-offset-transparent transition-all duration-200 transform hover:scale-[1.02] active:scale-[0.98]">
            <span id="btnText">Upload Avatar</span>
            <span id="btnLoader" class="hidden">
              <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline" xmlns="http://www.w3.org/2000/svg"
                fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor"
                  d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                </path>
              </svg>
              Uploading...
            </span>
          </button>
        </form>

        <div id="responseContainer" class="hidden">
          <div class="border-t border-white/20 pt-6">
            <h2 class="text-xl font-semibold text-white mb-4">API Response</h2>
            <div id="responseContent" class="space-y-4">
              <div id="responseStatus" class="px-4 py-3 rounded-lg font-mono text-sm"></div>
              <div id="responseBody" class="bg-black/30 rounded-lg p-4 overflow-x-auto">
                <pre id="responseJson" class="text-green-400 text-sm font-mono whitespace-pre-wrap"></pre>
              </div>
            </div>
          </div>
        </div>

        <div id="errorMessage" class="hidden bg-red-500/20 border border-red-500/50 text-red-200 px-4 py-3 rounded-lg">
        </div>
      </main>
    </div>
  </div>

  <script>
    const form = document.getElementById('uploadForm');
    const imageInput = document.getElementById('image');
    const imagePreview = document.getElementById('imagePreview');
    const previewImg = document.getElementById('previewImg');
    const submitBtn = document.getElementById('submitBtn');
    const btnText = document.getElementById('btnText');
    const btnLoader = document.getElementById('btnLoader');
    const responseContainer = document.getElementById('responseContainer');
    const responseStatus = document.getElementById('responseStatus');
    const responseJson = document.getElementById('responseJson');
    const errorMessage = document.getElementById('errorMessage');

    imageInput.addEventListener('change', function (e) {
      const file = e.target.files[0];
      if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = function (e) {
          previewImg.src = e.target.result;
          imagePreview.classList.remove('hidden');
        };
        reader.readAsDataURL(file);
      } else {
        imagePreview.classList.add('hidden');
      }
    });

    form.addEventListener('submit', async function (e) {
      e.preventDefault();

      const userId = document.getElementById('userId').value;
      const imageFile = imageInput.files[0];

      if (!userId || !imageFile) {
        showError('Please fill in all required fields');
        return;
      }

      setLoading(true);
      hideError();
      hideResponse();

      const formData = new FormData();
      formData.append('image', imageFile);

      try {
        const response = await fetch('/api/v1/avatars', {
          method: 'POST',
          headers: {
            'X-User-ID': userId
          },
          body: formData
        });

        const responseData = await response.text();
        let parsedData;

        try {
          parsedData = JSON.parse(responseData);
        } catch {
          parsedData = responseData;
        }

        displayResponse(response, parsedData);

      } catch (error) {
        showError(`Network error: ${error.message}`);
      } finally {
        setLoading(false);
      }
    });

    function setLoading(loading) {
      if (loading) {
        submitBtn.disabled = true;
        btnText.classList.add('hidden');
        btnLoader.classList.remove('hidden');
      } else {
        submitBtn.disabled = false;
        btnText.classList.remove('hidden');
        btnLoader.classList.add('hidden');
      }
    }

    function displayResponse(response, data) {
      responseContainer.classList.remove('hidden');

      const statusClass = response.ok
        ? response.status === 201 ? 'bg-green-500/20 border border-green-500/50 text-green-200'
          : 'bg-blue-500/20 border border-blue-500/50 text-blue-200'
        : 'bg-red-500/20 border border-red-500/50 text-red-200';

      responseStatus.className = `px-4 py-3 rounded-lg font-mono text-sm ${statusClass}`;
      responseStatus.textContent = `HTTP ${response.status} ${response.statusText}`;

      if (typeof data === 'object') {
        responseJson.textContent = JSON.stringify(data, null, 2);
      } else {
        responseJson.textContent = data;
      }

      if (!response.ok) {
        showError(`Request failed: ${response.status} ${response.statusText}`);
      }
    }

    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.classList.remove('hidden');
    }

    function hideError() {
      errorMessage.classList.add('hidden');
    }

    function hideResponse() {
      responseContainer.classList.add('hidden');
    }
  </script>
</body>

</html>